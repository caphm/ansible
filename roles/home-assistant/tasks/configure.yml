---
- name: Create appdata directory
  file:
    dest: "{{item}}"
    state: directory
    owner: "{{defaultuser.uid}}"
    group: "{{defaultuser.maingid}}"
  with_items:
    - "{{apphome}}"
    - "{{appdaemon_apphome}}"

- name: Download configuration files from github
  git:
    repo: https://github.com/caphm/hass-config.git
    version: "{{hass_variant}}"
    dest: /tmp/home-assistant

- name: Install configuration files
  synchronize:
    src: "/tmp/home-assistant"
    dest: "{{appdata}}/"
    recursive: yes
  notify: docker restart home-assistant

- name: Install secrets
  copy:
    src: "{{item}}"
    dest: "{{apphome}}/"
    owner: "{{defaultuser.uid}}"
    group: "{{defaultuser.maingid}}"
  with_items:
    - secrets.yaml
    - known_devices.yaml
  notify: docker restart home-assistant

- name: Install secret images
  copy:
    src: "{{item}}"
    dest: "{{apphome}}/www/"
    owner: "{{defaultuser.uid}}"
    group: "{{defaultuser.maingid}}"
  with_items:
    - anna.jpg
    - cpm.jpg
